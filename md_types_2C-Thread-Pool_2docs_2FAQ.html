<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Image Segmentation: Why isn&#39;t &lt;tt&gt;pthread_exit()&lt;/tt&gt; used to exit a thread?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Image Segmentation<span id="projectnumber">&#160;1.0.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Why isn't &lt;tt&gt;pthread_exit()&lt;/tt&gt; used to exit a thread?</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8"></a></p>
<p><code>thread_do</code> used to use <code>pthread_exit()</code>. However that resulted in hard times of testing for memory leaks. The reason is that on <code>pthread_exit()</code> not all memory is freed bt pthread (probably for future threads or false belief that the application is terminating). For these reasons a simple return is used.</p>
<p>Interestingly using <code>pthread_exit()</code> results in much more memory being allocated.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Why do you use <code>sleep()</code> after calling <code>thpool_destroy()</code>?</h2>
<p>This is needed only in the tests. The reason is that if you call <code><a class="el" href="thpool_8c.html#ae35764bc7ae46da374abd9d44db547ae">thpool_destroy()</a></code> and then exit immediately, maybe the program will exit before all the threads had the time to deallocate. In that way it is impossible to check for memory leaks.</p>
<p>In production you don't have to worry about this since if you call <code>exit()</code>, immediately after you destroyed the pool, the threads will be freed anyway by the OS. If you anyway destroy the pool in the middle of your program it doesn't matter again since the program will not exit immediately and thus threads will have more than enough time to terminate.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Why does <code>wait()</code> use all my CPU?</h2>
<p>Notice: As of 11-Dec-2015 <code>wait()</code> doesn't use polling anymore. Instead a conditional variable is being used so in theory there should not be any CPU overhead.</p>
<p>Normally <code>wait()</code> will spike CPU usage to full when called. This is normal as long as it doesn't last for more than 1 second. The reason this happens is that <code>wait()</code> goes through various phases of polling (what is called smart polling).</p>
<ul>
<li>Initially there is no interval between polling and hence the 100% use of your CPU.</li>
<li>After that the polling interval grows exponentially.</li>
<li>Finally after x seconds, if there is still work, polling falls back to a very big interval.</li>
</ul>
<p>The reason <code>wait()</code> works in this way, is that the function is mostly used when someone wants to wait for some calculation to finish. So if the calculation is assumed to take a long time then we don't want to poll too often. Still we want to poll fast in case the calculation is a simple one. To solve these two problems, this seemingly awkward behaviour is present. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
